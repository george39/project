<section class="container pt-4">
  <div class="row">
    <div class="col-sm-11">
      <h1>
        {{ vm.category._id ? 'CATEGORY.EDIT' : ('CATEGORY.NEW' | translate) }}
      </h1>
    </div>
    <div class="col-sm-1">
      <a ng-show="vm.category._id" class="btn btn-primary" ng-click="vm.remove()">
        <i class="fas fa-trash-alt"> </i>
      </a>
    </div>

    <div class="col-sm-12">
      <form
        name="vm.form.categoryForm"
        class="needs-validation"
        ng-submit="vm.save(vm.form.categoryForm.$valid)"
        novalidate
      >
        <div class="form-row">
          <div class="col-md-12 mb-3">
            <label class="control-label" for="parent">
              {{ 'CATEGORY.PARENT' | translate }}
            </label>
            <select
              class="custom-select"
              name="parent"
              id="parent"
              ng-model="vm.category.parent"
              ng-options="item as item.name for item in vm.listCategoriesParents track by item._id"
              ng-init="vm.category.parent._id"
              required
              autofocus
            >
              <option selected disabled value="">{{ 'CATEGORY.SELECT' | translate }}</option>
              <!-- <option ng-repeat="item in vm.listCategoriesParents track by item._id" value="{{item._id}}">
                {{item.name}}
              </option> -->
            </select>
            <div class="valid-feedback">
              {{ 'CATEGORY.VALID' | translate }}
            </div>
            <div class="invalid-feedback">
              {{ 'CATEGORY.INVALID' | translate }}
            </div>
          </div>

          <fieldset class="border p-2 col-md-12" ng-repeat="item in vm.listLangs">
            <legend class="w-auto">{{ item.name }}</legend>

            <div class="row">
              <div ng-show="false" class="col-md-12 mb-3">
                <label class="control-label" for="categoryLang">
                  {{ 'CATEGORY.LANG_ID' | translate }}
                </label>
                <input
                  class="form-control"
                  name="categoryLang[{{ $index }}]"
                  id="categoryLang[{{ $index }}]"
                  ng-init="vm.category.categoryLang[$index].lang_id=item._id"
                  ng-model="vm.category.categoryLang[$index].lang_id"
                />
              </div>

              <div class="col-md-12 mb-3">
                <label class="control-label" for="categoryLang">
                  {{ 'CATEGORY.NAME' | translate }}
                </label>
                <input
                  type="text"
                  class="form-control"
                  name="categoryName[{{ $index }}]"
                  id="categoryName[{{ $index }}]"
                  ng-model="vm.category.categoryLang[$index].name"
                  required
                />
                <div class="valid-feedback">
                  {{ 'CATEGORY.VALID_NAME' | translate }}
                </div>
                <div class="invalid-feedback">
                  {{ 'CATEGORY.INVALID_NAME' | translate }}
                </div>
              </div>

              <div class="col-md-12 mb-3">
                <label class="control-label" for="categoryLang">
                  {{ 'CATEGORY.DESCRIPTION' | translate }}
                </label>
                <input
                  type="text"
                  class="form-control"
                  name="categoryDescription[{{ $index }}]"
                  id="categoryDescription[{{ $index }}]"
                  ng-model="vm.category.categoryLang[$index].description"
                  required
                />
                <div class="valid-feedback">
                  {{ 'CATEGORY.VALID_DESCRIPTION' | translate }}
                </div>
                <div class="invalid-feedback">
                  {{ 'CATEGORY.INVALID_DESCRIPTION' | translate }}
                </div>
              </div>

              <div class="col-md-12 mb-3">
                <label class="control-label" for="categoryLang">
                  {{ 'GLOBAL.LINK_REWRITE' | translate }}
                </label>
                <input
                  type="text"
                  class="form-control"
                  name="categoryLinkRewrite[{{ $index }}]"
                  id="categoryLinkRewrite[{{ $index }}]"
                  ng-model="vm.category.categoryLang[$index].linkRewrite"
                  required
                />
                <div class="valid-feedback">
                  {{ 'GLOBAL.VALID_LINK_REWRITE' | translate }}
                </div>
                <div class="invalid-feedback">
                  {{ 'GLOBAL.INVALID_LINK_REWRITE' | translate }}
                </div>
              </div>

              <div class="col-md-12 mb-3">
                <label class="control-label" for="categoryLang">
                  {{ 'GLOBAL.META_TITLE' | translate }}
                </label>
                <input
                  type="text"
                  class="form-control"
                  name="categoryMetaTitle[{{ $index }}]"
                  id="categoryMetaTitle[{{ $index }}]"
                  ng-model="vm.category.categoryLang[$index].metaTitle"
                  required
                />
                <div class="valid-feedback">
                  {{ 'GLOBAL.VALID_META_TITLE' | translate }}
                </div>
                <div class="invalid-feedback">
                  {{ 'GLOBAL.INVALID_META_TITLE' | translate }}
                </div>
              </div>

              <div class="col-md-12 mb-3">
                <label class="control-label" for="categoryLang">
                  {{ 'GLOBAL.META_KEYWORDS' | translate }}
                </label>
                <input
                  type="text"
                  class="form-control"
                  name="categoryMetaKeywords[{{ $index }}]"
                  id="categoryMetaKeywords[{{ $index }}]"
                  ng-model="vm.category.categoryLang[$index].metaKeywords"
                  required
                />
                <div class="valid-feedback">
                  {{ 'GLOBAL.VALID_META_KEYWORDS' | translate }}
                </div>
                <div class="invalid-feedback">
                  {{ 'GLOBAL.INVALID_META_KEYWORDS' | translate }}
                </div>
              </div>

              <div class="col-md-12 mb-3">
                <label class="control-label" for="categoryLang">
                  {{ 'GLOBAL.META_DESCRIPTION' | translate }}
                </label>
                <input
                  type="text"
                  class="form-control"
                  name="categoryMetaDescription[{{ $index }}]"
                  id="categoryMetaDescription[{{ $index }}]"
                  ng-model="vm.category.categoryLang[$index].metaDescription"
                  required
                />
                <div class="valid-feedback">
                  {{ 'GLOBAL.VALID_META_DESCRIPTION' | translate }}
                </div>
                <div class="invalid-feedback">
                  {{ 'GLOBAL.INVALID_META_DESCRIPTION' | translate }}
                </div>
              </div>
            </div>
          </fieldset>

          <div ng-show="vm.category._id" class="col-md-12 mb-3">
            <label class="control-label" for="categoryLang">
              {{ 'CATEGORY.ORDER' | translate }}
            </label>
            <input
              type="text"
              class="form-control"
              name="order"
              id="order"
              ng-model="vm.category.order"
            />
          </div>

          <div class="col-md-12 mb-3">
            <label class="control-label" for="outstanding" translate>
              {{ 'CATEGORY.OUTSTANDING' | translate }}
            </label>
            <input
              class="form-control"
              type="checkbox"
              name="outstanding"
              id="outstanding"
              data-ng-model="vm.category.outstanding"
              checked="true"
            />
          </div>

          <div class="col-md-12 mb-3">
            <label class="control-label" for="showSection" translate>
              {{ 'GLOBAL.SHOW_SECTION' | translate }}
            </label>
            <input
              class="form-control"
              type="checkbox"
              name="showSection"
              id="showSection"
              data-ng-model="vm.category.showSection"
            />
          </div>

          <div class="col-md-12 mb-3">
            <label class="control-label" for="status" translate>
              {{ 'GLOBAL.STATUS' | translate }}
            </label>
            <input
              class="form-control"
              type="checkbox"
              name="status"
              id="status"
              data-ng-model="vm.category.status"
              checked="true"
            />
          </div>

          <!-- Cargar Imagen -->
          <div class="col-md-12 mb-3">
            <div class="row">
              <!-- Titulo Cargar Imagen -->
              <div class="col-md-12">
                <label class="control-label">
                  {{ 'CATEGORY.LOAD_IMAGE' | translate }}
                </label>
              </div>

              <div class="col-md-12 mb-3" ng-if="vm.multiFiles">
                <div class="progress">
                  <div
                    class="progress-bar progress-bar-striped progress-bar-animated"
                    role="progressbar"
                    ng-style="{ width: vm.valueProgress + '%' }"
                    aria-valuenow="{{ vm.valueProgress }}"
                    aria-valuemin="0"
                    aria-valuemax="100"
                  >
                    {{ vm.valueProgress }}%
                  </div>
                </div>
              </div>

              <!-- Muestra Imagenes -->
              <div class="col-md-12" ng-if="vm.multiFiles">
                <div class="form-group text-center">
                  <div ng-repeat="file in vm.category.files">
                    <div class="form-group text-center">
                      <img
                        ngf-src="file.$ngfName ? file : file.path"
                        alt="{{ vm.user.displayName }}"
                        class="rounded mx-auto d-bloc user-profile-picture"
                      />
                    </div>
                    <div class="form-group text-center">
                      <label class="control-label">
                        {{ file.$ngfName ? file.$ngfName : file.originalname }}
                      </label>
                    </div>
                    <div class="form-group text-center">
                      <a
                        type="button"
                        class="btn btn-danger"
                        ng-click="vm.removeFileById(file, vm.fileSelected ? 'files' : 'managerFile_id')"
                      >
                        X
                      </a>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Muestra Imagen Unitaria -->
              <div class="col-md-12" ng-if="!vm.multiFiles">
                <div ng-show="vm.loading" class="form-group text-center">
                  <img
                    ng-src="/modules/core/client/img/loaders/loader.gif"
                    height="50"
                    width="50"
                    alt="Loading image..."
                  />
                </div>
                <div class="form-group text-center">
                  <img
                    ngf-src="vm.fileSelected ? vm.category.files : vm.category.managerFile_id[0].path"
                    alt="{{ vm.user.displayName }}"
                    class="img-thumbnail user-profile-picture"
                    ngf-drop
                  />
                </div>
                <div class="form-group text-center">
                  <label class="control-label">
                    {{
                      vm.fileSelected
                        ? vm.category.files.$ngfName
                        : vm.category.managerFile_id[0].originalname
                    }}
                  </label>
                </div>
              </div>

              <!-- Boton Selecciones Imagen  -->
              <div class="col-md-12">
                <div class="text-center form-group">
                  <button
                    class="btn btn-secondary btn-file"
                    ngf-select="vm.uploadFiles($files)"
                    ng-model="vm.category.files"
                    accept="image/*"
                    ngf-before-model-change="vm.loading = true;"
                    ngf-resize="{width: 400, height: 400}"
                    ngf-resize-if="$width > 400 || $height > 400"
                    ngf-max-files="10"
                    ngf-multiple="vm.multiFiles"
                    ngf-keep="vm.multiFiles ? 'distinct' : false"
                  >
                    {{ 'MANAGER_FILE.SELECT_PICTURE' | translate }}
                  </button>
                </div>
                <div class="text-center form-group">
                  <input
                    ng-show="false"
                    class="form-control"
                    type="checkbox"
                    name="isFileSelected"
                    id="isFileSelected"
                    ng-model="vm.category.isFileSelected"
                    required
                  />
                  <div class="valid-feedback text-center">
                    {{ 'MANAGER_FILE.VALID_NAME' | translate }}
                  </div>
                  <div class="invalid-feedback text-center">
                    {{ 'MANAGER_FILE.INVALID_NAME' | translate }}
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- // Fin Cargar Imagenes -->

          <div class="col-md-12 mb-3">
            <button type="submit" class="btn btn-primary">
              {{ (vm.category._id ? 'GLOBAL.UPDATE' : 'GLOBAL.CREATE') | translate }}
            </button>
          </div>
        </div>
      </form>
    </div>
  </div>
</section>
